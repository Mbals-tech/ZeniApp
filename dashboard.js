import { useEffect, useState } from 'react'; function authFetch(path, opts={}){ const token = typeof window !== 'undefined' ? localStorage.getItem('token') : null; return fetch(path, { ...opts, headers:{ ...(opts.headers||{}), Authorization: token ? 'Bearer '+token : '' } }); } export default function Dashboard(){ const [user,setUser] = useState(null); const [investments,setInvestments] = useState([]); const [settings,setSettings] = useState(null); useEffect(()=>{ load(); }, []); async function load(){ const res1 = await authFetch('/api/me'); if(res1.ok) setUser(await res1.json()); const res2 = await authFetch('/api/investments'); if(res2.ok) setInvestments(await res2.json()); const res3 = await fetch('/api/admin/settings'); if(res3.ok) setSettings(await res3.json()); } if(!user) return <div style={{padding:40}}>Loading (or please log in)</div>; function whatsappLink(){ const w = process.env.NEXT_PUBLIC_SUPPORT_WHATSAPP || null; if(!w) return '#'; return `https://wa.me/${w}?text=${encodeURIComponent('Hello Zeni Vault Support')}`; } return ( <div style={{maxWidth:900, margin:'40px auto', fontFamily:'sans-serif', padding:'0 16px'}}> <h2>Welcome, {user.full_name}</h2> <div> <strong>Your referral link:</strong> <div><input readOnly value={`${typeof window !== 'undefined' ? window.location.origin : ''}/register?ref=${user.referral_code}`} style={{width:'100%'}}/></div> </div> <section style={{marginTop:20}}> <h3>Your Investments</h3> {investments.length===0 && <div>No investments yet.</div>} {investments.map(inv=> ( <div key={inv.id} style={{border:'1px solid #ddd', padding:12, marginBottom:10}}> <div><strong>Package:</strong> {inv.package_key}</div> <div><strong>Deposit:</strong> R{inv.deposit_amount}</div> <div><strong>Status:</strong> {inv.status}</div> <div><strong>Daily Return:</strong> R{inv.daily_return}</div> <div><strong>Start date:</strong> {inv.start_date || 'N/A'}</div> <div><strong>Proof:</strong> {inv.proof_url ? <a href={inv.proof_url} target="_blank">View</a> : 'Not uploaded'}</div> </div> ))} </section> <section style={{marginTop:20}}> <h3>Support</h3> <a href={whatsappLink()} target="_blank">Contact Support on WhatsApp</a> </section> </div> ); }